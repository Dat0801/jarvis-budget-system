<ion-header class="jars-header" translucent="true">
  <ion-toolbar>
    <ion-title>My Budgets</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" class="icon-button">
        <ion-icon name="search-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" class="icon-button avatar-button">
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="jars-page" fullscreen="true">
  <div class="page-inner">
    <section class="total-card">
      <div class="total-label">TOTAL SAVED</div>
      <div class="total-amount">
        <span class="currency">₫</span>
        <span class="value">{{ totalSavedMain }}</span>
        <span class="cents">.{{ totalSavedCents }}</span>
      </div>
      <div class="total-trend">
        <ion-icon name="trending-up-outline"></ion-icon>
        <span>+12.5% from last month</span>
      </div>
    </section>

    <div class="section-title">ACTIVE BUDGETS</div>

    <section class="jars-list">
      <article class="jar-card" *ngFor="let jar of jars" (click)="navigateToJar(jar.id)">
        <div class="jar-icon" [ngClass]="getJarIconClass(jar)">
          <ion-icon [name]="getJarIcon(jar)"></ion-icon>
        </div>
        <div class="jar-info">
          <div class="jar-title-row">
            <div class="jar-title">{{ jar.name }}</div>
            <ion-button fill="clear" class="more-button">
              <ion-icon name="ellipsis-vertical"></ion-icon>
            </ion-button>
          </div>
          <div class="jar-subtitle">
            {{ getJarDescription(jar) }}
          </div>
          <div class="jar-amount-row">
            <div class="jar-amount">
              {{ formatCurrency(jar.balance) }}
              <span class="jar-target">/ {{ formatCurrency(getJarTarget(jar)) }}</span>
            </div>
            <div class="jar-percent">{{ getJarProgress(jar) }}%</div>
          </div>
          <div class="progress-track">
            <div
              class="progress-fill"
              [style.width.%]="getJarProgress(jar)"
            ></div>
          </div>
        </div>
      </article>
    </section>
  </div>
</ion-content>

<ion-modal
  [isOpen]="isCreateJarOpen"
  (didDismiss)="closeCreateJar()"
  class="transaction-modal"
>
  <ng-template>
    <ion-header class="transaction-header">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button fill="clear" (click)="closeCreateJar()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-title>Add Budget</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content class="transaction-page">
      <form (ngSubmit)="submitCreateJar()">
        <div class="amount-block">
          <div class="amount-label">TARGET</div>
          <div class="amount-input-row">
            <div class="currency">₫</div>
            <ion-input
              type="text"
              inputmode="numeric"
              placeholder="0"
              [(ngModel)]="jarTarget"
              (ionInput)="onJarTargetInput($event)"
              name="jarTarget"
            ></ion-input>
          </div>
        </div>

        <ion-card class="section-card">
          <div class="section-title">Budget Details</div>

          <div class="field">
            <div class="field-label">BUDGET NAME</div>
            <ion-item lines="none" class="text-item">
              <ion-input
                placeholder="e.g. Groceries"
                [(ngModel)]="jarName"
                name="jarName"
                required
              ></ion-input>
            </ion-item>
          </div>

          <div class="field">
            <div class="field-label">DESCRIPTION</div>
            <ion-item lines="none" class="notes-item">
              <ion-textarea
                auto-grow="true"
                placeholder="What is this budget for?"
                [(ngModel)]="jarDescription"
                name="jarDescription"
              ></ion-textarea>
            </ion-item>
          </div>
        </ion-card>

        <ion-card class="receipt-card">
          <ion-item lines="none" button detail="true">
            <ion-icon slot="start" name="color-palette-outline"></ion-icon>
            <ion-label>Choose Icon</ion-label>
          </ion-item>
        </ion-card>

        <ion-button
          expand="block"
          class="save-button"
          type="submit"
          [disabled]="!canSaveJar"
        >
          Save Budget
        </ion-button>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>
