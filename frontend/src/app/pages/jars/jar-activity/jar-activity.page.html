<app-page-header
  [title]="jar?.name || 'Wallet Detail'"
  [translucent]="true"
  [showBack]="true"
  backHref="/tabs/budgets"
  headerClass="activity-header"
></app-page-header>

<ion-content class="activity-page" fullscreen="true">
  <div class="page-inner">
    <div class="loading-state" *ngIf="isLoadingTransactions">
      <ion-spinner name="crescent"></ion-spinner>
      <span>Loading transactions...</span>
    </div>

    <ng-container *ngIf="!isLoadingTransactions">
      <section class="month-tabs" *ngIf="monthTabs.length > 0">
        <ion-segment [value]="selectedMonthKey" scrollable="true" (ionChange)="onMonthChange($event)">
          <ion-segment-button *ngFor="let tab of monthTabs; trackBy: trackByMonth" [value]="tab.key">
            <ion-label>{{ tab.label }}</ion-label>
          </ion-segment-button>
        </ion-segment>
      </section>

      <section class="transaction-section" *ngIf="monthTabs.length > 0">
        <div class="section-header-row">
          <h3>Inflow</h3>
        </div>

        <div class="section-list" *ngIf="inflowTransactions.length > 0; else inflowEmpty">
          <article class="activity-item" *ngFor="let transaction of inflowTransactions; trackBy: trackByTransaction">
            <div class="activity-icon icon-success">
              <ion-icon [name]="getTransactionIcon(transaction)"></ion-icon>
            </div>
            <div class="activity-info">
              <div class="activity-title">
                {{ transaction.note || transaction.source || transaction.category || 'Transaction' }}
              </div>
              <div class="activity-date">{{ getFormattedDate(transaction.created_at) }}</div>
            </div>
            <div class="activity-amount amount-success">
              <span class="sign">+</span>{{ formatCurrency(transaction.amount) }}
            </div>
          </article>
        </div>

        <ng-template #inflowEmpty>
          <div class="section-empty">No inflow in this month</div>
        </ng-template>
      </section>

      <section class="transaction-section" *ngIf="monthTabs.length > 0">
        <div class="section-header-row">
          <h3>Outflow</h3>
        </div>

        <div class="section-list" *ngIf="outflowTransactions.length > 0; else outflowEmpty">
          <article class="activity-item" *ngFor="let transaction of outflowTransactions; trackBy: trackByTransaction">
            <div class="activity-icon icon-danger">
              <ion-icon [name]="getTransactionIcon(transaction)"></ion-icon>
            </div>
            <div class="activity-info">
              <div class="activity-title">
                {{ transaction.note || transaction.source || transaction.category || 'Transaction' }}
              </div>
              <div class="activity-date">{{ getFormattedDate(transaction.created_at) }}</div>
            </div>
            <div class="activity-amount amount-danger">
              <span class="sign">-</span>{{ formatCurrency(transaction.amount) }}
            </div>
          </article>
        </div>

        <ng-template #outflowEmpty>
          <div class="section-empty">No outflow in this month</div>
        </ng-template>
      </section>

      <div class="empty-state" *ngIf="monthTabs.length > 0 && filteredTransactions.length === 0">
        <ion-icon name="calendar-outline"></ion-icon>
        <h3>No transactions in this month</h3>
        <p>Try selecting another month tab</p>
      </div>

      <div class="empty-state" *ngIf="transactions.length === 0 && filteredTransactions.length === 0">
        <ion-icon name="archive-outline"></ion-icon>
        <h3>No Activity Yet</h3>
        <p>This wallet doesn't have any transactions yet</p>
      </div>
    </ng-container>
  </div>
</ion-content>
